{% extends "layout.html" %}

{% block title %}
    Dragandrop
{% endblock %}

{% block main %}
<script>
    // make an array list with the answers
    
    const answers = [{conjugation:"comen", id:"comen"},
        {conjugation:"come", id:"come"}, 
        {conjugation:"comemos", id:"comemos"}];
    
    //Select the blank in the qustion and make a constant.
    //Set id to be used later for answer validation    
    const blank = document.querySelector('.blank');
    blank.dataset.id = "come";
    
    //Select element in the HTML where coices will be displayed
    const choices = document.getElementById('choices');
    
    //Create constants and display choices for the answer
    for (let i = 0; i < answers.length; i++) {
        const span = document.createElement("span");
        span.className = "choice";
        span.id = answers[i].conjugation;
        span.draggable = true;
        span.textContent = answers[i].conjugation;
        choices.appendChild(span);
      }
//dragged will be the element that is dragged from the choices list
//when the dragg starts we can set the data from the element so we can get it when the user drops it.
let dragged = null;
choices.addEventListener('dragstart', e => {
    e.dataTransfer.setData('id', e.target.id);
    dragged = event.target;
})
//Add effects for the blank zone when the user drags the element over it
blank.addEventListener('dragover', e => {
    e.preventDefault();
    if (blank.firstChild) {
            e.dataTransfer.dropEffect = 'none';
    } 
    else {
            e.target.classList.add('hover');
        }  
})

//Remove effects when leaves the blank zone
blank.addEventListener('dragleave', e => {
    e.target.classList.remove('hover');
})

//The blank zone removes the effect, gets the data from the item and allow drop
blank.addEventListener('drop', e => {
    e.target.classList.remove('hover');
    const id = e.dataTransfer.getData('id');
    if (e.target.className === 'blank' && !blank.firstChild){
        e.target.appendChild(dragged);
    }
})

//reverse process if the user wants to change the answer before submitting
blank.addEventListener('dragstart', e => {
    e.dataTransfer.setData('id', e.target.id);
    dragged = event.target;
})

choices.addEventListener('dragover', e => {
    e.preventDefault();
    e.target.classList.add('hover');
    
})

choices.addEventListener('dragleave', e => {
    e.target.classList.remove('hover');
})

choices.addEventListener('drop', e => {
    e.target.classList.remove('hover');
    const id = e.dataTransfer.getData('id');
    if (e.target.className === 'choices'){
        e.target.appendChild(dragged);
    }
})

//create constants and variables to validate answers and update points
const points = document.querySelector('#points')
const feedback = document.querySelector('#feedback');
const submit = document.querySelector('#submit');

let total_points = 0;

//When the button submit is clicked prevent the page from refreshing
//validate answer by checking both ids
//Provide feedback and update the points
submit.addEventListener("click", e => {
    e.preventDefault();
    console.log(dragged.id);
    if(dragged.id === blank.id){
        feedback.textContent = '¡Muy bien!';
        total_points++;
        points.textContent = "Total points: " + total_points;
    }
    else{
        feedback.textContent = '¡Uy, casi!';
    }
});
</script>
{% endblock %}
   